# ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ ã‚¯ãƒ­ãƒ¼ãƒ³ è¨­è¨ˆæ›¸

## 1. æ¦‚è¦

### 1.1 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
ãƒœãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã€Œã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ ï¼ˆCodenamesï¼‰ã€ã®Webã‚¯ãƒ­ãƒ¼ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚
ãƒ–ãƒ©ã‚¦ã‚¶ä¸Šã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¤ãŒå¯èƒ½ã€‚

### 1.2 åŸºæœ¬ãƒ«ãƒ¼ãƒ«
- 5Ã—5ã®25æšã®å˜èªã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
- èµ¤ãƒãƒ¼ãƒ ï¼ˆ9æšï¼‰ã€é’ãƒãƒ¼ãƒ ï¼ˆ8æšï¼‰ã€ä¸€èˆ¬å¸‚æ°‘ï¼ˆ7æšï¼‰ã€æš—æ®ºè€…ï¼ˆ1æšï¼‰
- å„ãƒãƒ¼ãƒ ã«ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ï¼ˆãƒ’ãƒ³ãƒˆã‚’å‡ºã™äººï¼‰ã¨ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ï¼ˆæ¨æ¸¬ã™ã‚‹äººï¼‰ãŒã„ã‚‹
- ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãŒã€Œå˜èª + æ•°å­—ã€ã®ãƒ’ãƒ³ãƒˆã‚’å‡ºã—ã€ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãŒã‚«ãƒ¼ãƒ‰ã‚’æ¨æ¸¬
- æš—æ®ºè€…ã‚’é¸ã‚“ã ã‚‰å³æ•—åŒ—
- å…ˆã«è‡ªãƒãƒ¼ãƒ ã®ã‚«ãƒ¼ãƒ‰ã‚’å…¨ã¦è¦‹ã¤ã‘ãŸãƒãƒ¼ãƒ ã®å‹åˆ©

### 1.3 ç¢ºå®šä»•æ§˜

| é …ç›® | ä»•æ§˜ |
|------|------|
| èªè¨¼ | ã‚²ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ã®ã¿ï¼ˆãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ å…¥åŠ›ï¼‰ |
| å˜èªãƒ‘ãƒƒã‚¯ | èª°ã§ã‚‚ä½œæˆå¯ã€å…¬é–‹/éå…¬é–‹é¸æŠ |
| ãƒœã‚¤ã‚¹ãƒãƒ£ãƒƒãƒˆ | ãªã—ï¼ˆå¤–éƒ¨ãƒ„ãƒ¼ãƒ«ä½µç”¨æƒ³å®šï¼‰ |
| åˆæœŸå˜èª | æ—¥æœ¬èª1000èª |
| ã‚²ãƒ¼ãƒ å±¥æ­´ | ä¿å­˜ã—ãªã„ï¼ˆçµ‚äº†æ™‚å‰Šé™¤ï¼‰ |
| ãƒ«ãƒ¼ãƒ æœ‰åŠ¹æœŸé™ | æœ€çµ‚ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‹ã‚‰12æ™‚é–“ |
| æœ€å¤§äººæ•° | 12äºº/ãƒ«ãƒ¼ãƒ  |
| è¦³æˆ¦è€… | ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼/ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼é¸æŠå¯ |

---

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€” |
|------|-----------|------|
| React | 18.x | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| TypeScript | 5.x | å‹å®‰å…¨ãªé–‹ç™º |
| Vite | 5.x | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« |
| Tailwind CSS | 3.x | ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚° |
| React Router | 6.x | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| Zustand | 4.x | çŠ¶æ…‹ç®¡ç† |
| @supabase/supabase-js | 2.x | Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |

### 2.2 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆSupabaseï¼‰
| æ©Ÿèƒ½ | ç”¨é€” |
|------|------|
| PostgreSQL | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |
| Realtime | ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸï¼ˆBroadcast/Presenceï¼‰ |
| Edge Functions | è¤‡é›‘ãªã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰ |
| RLS (Row Level Security) | ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ |

### 2.3 ã‚¤ãƒ³ãƒ•ãƒ©
| æŠ€è¡“ | ç”¨é€” |
|------|------|
| Supabase | BaaSï¼ˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°å«ã‚€ï¼‰ |
| Vercel / Netlify | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚° |

---

## 3. æ©Ÿèƒ½ä¸€è¦§

### 3.1 ãƒ«ãƒ¼ãƒ ç®¡ç†

| ID | æ©Ÿèƒ½å | èª¬æ˜ | å„ªå…ˆåº¦ |
|----|--------|------|--------|
| R-01 | ãƒ«ãƒ¼ãƒ ä½œæˆ | æ–°è¦ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã—ã€ãƒ›ã‚¹ãƒˆã«ãªã‚‹ | å¿…é ˆ |
| R-02 | ãƒ«ãƒ¼ãƒ å‚åŠ  | ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã¾ãŸã¯URLã§ãƒ«ãƒ¼ãƒ ã«å‚åŠ  | å¿…é ˆ |
| R-03 | å…¬é–‹ãƒ«ãƒ¼ãƒ ä¸€è¦§ | å…¬é–‹ãƒ«ãƒ¼ãƒ ã®ä¸€è¦§ã‚’è¡¨ç¤ºãƒ»å‚åŠ  | å¿…é ˆ |
| R-04 | ãƒ«ãƒ¼ãƒ è¨­å®š | å˜èªãƒ‘ãƒƒã‚¯é¸æŠã€å…¬é–‹/éå…¬é–‹è¨­å®š | å¿…é ˆ |
| R-05 | ãƒ«ãƒ¼ãƒ è‡ªå‹•å‰Šé™¤ | 12æ™‚é–“éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§è‡ªå‹•å‰Šé™¤ | å¿…é ˆ |

### 3.2 ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ç®¡ç†

| ID | æ©Ÿèƒ½å | èª¬æ˜ | å„ªå…ˆåº¦ |
|----|--------|------|--------|
| P-01 | ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ è¨­å®š | ã‚²ãƒ¼ãƒ å‚åŠ æ™‚ã«ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’å…¥åŠ› | å¿…é ˆ |
| P-02 | ãƒãƒ¼ãƒ é¸æŠ | èµ¤/é’/è¦³æˆ¦è€…ã‹ã‚‰é¸æŠ | å¿…é ˆ |
| P-03 | å½¹å‰²é¸æŠ | ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼/ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ã‹ã‚‰é¸æŠ | å¿…é ˆ |
| P-04 | è¦³æˆ¦ãƒ“ãƒ¥ãƒ¼é¸æŠ | è¦³æˆ¦æ™‚ã®ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰é¸æŠ | å¿…é ˆ |

### 3.3 ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤

| ID | æ©Ÿèƒ½å | èª¬æ˜ | å„ªå…ˆåº¦ |
|----|--------|------|--------|
| G-01 | ã‚²ãƒ¼ãƒ é–‹å§‹ | ãƒ›ã‚¹ãƒˆãŒã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ï¼ˆæ¡ä»¶ãƒã‚§ãƒƒã‚¯ï¼‰ | å¿…é ˆ |
| G-02 | ãƒœãƒ¼ãƒ‰ç”Ÿæˆ | 25æšã®ã‚«ãƒ¼ãƒ‰ã‚’ãƒ©ãƒ³ãƒ€ãƒ é…ç½® | å¿…é ˆ |
| G-03 | ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ | å…¨ã‚«ãƒ¼ãƒ‰ã®è‰²ãŒè¦‹ãˆã‚‹ç‰¹åˆ¥ãƒ“ãƒ¥ãƒ¼ | å¿…é ˆ |
| G-04 | ãƒ’ãƒ³ãƒˆå…¥åŠ› | ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãŒãƒ’ãƒ³ãƒˆå˜èªã¨æ•°å­—ã‚’å…¥åŠ› | å¿…é ˆ |
| G-05 | ã‚«ãƒ¼ãƒ‰é¸æŠ | ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãŒã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ | å¿…é ˆ |
| G-06 | ã‚¿ãƒ¼ãƒ³ç®¡ç† | ãƒ‘ã‚¹æ©Ÿèƒ½ã€æ¨æ¸¬å›æ•°ç®¡ç† | å¿…é ˆ |
| G-07 | å‹æ•—åˆ¤å®š | å‹åˆ©æ¡ä»¶ãƒ»æ•—åŒ—æ¡ä»¶ã®ãƒã‚§ãƒƒã‚¯ | å¿…é ˆ |
| G-08 | ã‚²ãƒ¼ãƒ çµ‚äº† | çµæœè¡¨ç¤ºã€å†æˆ¦ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | å¿…é ˆ |
| G-09 | ãƒãƒ£ãƒƒãƒˆ | ãƒ«ãƒ¼ãƒ å†…ãƒ†ã‚­ã‚¹ãƒˆãƒãƒ£ãƒƒãƒˆ | ä»»æ„ |
| G-10 | ã‚¿ãƒ¼ãƒ³ã‚¿ã‚¤ãƒãƒ¼ | åˆ¶é™æ™‚é–“è¨­å®šï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ | ä»»æ„ |

### 3.4 å˜èªãƒ‘ãƒƒã‚¯

| ID | æ©Ÿèƒ½å | èª¬æ˜ | å„ªå…ˆåº¦ |
|----|--------|------|--------|
| W-01 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ‘ãƒƒã‚¯ | æ—¥æœ¬èª1000èªã®ã‚·ã‚¹ãƒ†ãƒ ãƒ‘ãƒƒã‚¯ | å¿…é ˆ |
| W-02 | ãƒ‘ãƒƒã‚¯ä½œæˆ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå˜èªãƒ‘ãƒƒã‚¯ã‚’ä½œæˆ | å¿…é ˆ |
| W-03 | ãƒ‘ãƒƒã‚¯ç·¨é›† | ä½œæˆã—ãŸãƒ‘ãƒƒã‚¯ã®ç·¨é›† | å¿…é ˆ |
| W-04 | ãƒ‘ãƒƒã‚¯å…¬é–‹è¨­å®š | å…¬é–‹/éå…¬é–‹ã®åˆ‡ã‚Šæ›¿ãˆ | å¿…é ˆ |
| W-05 | å…¬é–‹ãƒ‘ãƒƒã‚¯ä¸€è¦§ | å…¬é–‹ã•ã‚ŒãŸãƒ‘ãƒƒã‚¯ã®ä¸€è¦§ãƒ»é¸æŠ | å¿…é ˆ |

---

## 4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ

### 4.1 ERå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  word_packs  â”‚       â”‚    words     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚
â”‚ name         â”‚   1:N â”‚ word_pack_id â”‚
â”‚ description  â”‚       â”‚ word         â”‚
â”‚ is_public    â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ is_default   â”‚
â”‚ language     â”‚
â”‚ creator_id   â”‚
â”‚ created_at   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1:N
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    rooms     â”‚       â”‚   players    â”‚       â”‚    hints     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)      â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚â”€â”€â”€â”€â”€â”€â”€â”‚ id (PK)      â”‚
â”‚ code         â”‚   1:N â”‚ room_id (FK) â”‚   1:N â”‚ room_id (FK) â”‚
â”‚ name         â”‚       â”‚ nickname     â”‚       â”‚ player_id    â”‚
â”‚ status       â”‚       â”‚ team         â”‚       â”‚ word         â”‚
â”‚ is_public    â”‚       â”‚ role         â”‚       â”‚ count        â”‚
â”‚ word_pack_id â”‚       â”‚ is_host      â”‚       â”‚ team         â”‚
â”‚ current_turn â”‚       â”‚ spectator_   â”‚       â”‚ created_at   â”‚
â”‚ winner       â”‚       â”‚   view       â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ timer_sec    â”‚       â”‚ created_at   â”‚
â”‚ guesses_left â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ created_at   â”‚
â”‚ updated_at   â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
        â”‚                      â”‚
        â”‚ 1:N                  â”‚
        â–¼                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚    cards     â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
â”‚ id (PK)      â”‚               â”‚
â”‚ room_id (FK) â”‚               â”‚
â”‚ word         â”‚               â”‚
â”‚ position     â”‚               â”‚
â”‚ type         â”‚               â”‚
â”‚ is_revealed  â”‚               â”‚
â”‚ revealed_by  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 Supabase SQL ã‚¹ã‚­ãƒ¼ãƒ

```sql
-- ENUMã®ä»£ã‚ã‚Šã«CHECKåˆ¶ç´„ã‚’ä½¿ç”¨ï¼ˆSupabaseæ¨å¥¨ï¼‰

-- ãƒ«ãƒ¼ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE rooms (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(6) UNIQUE NOT NULL,
  name VARCHAR(100) NOT NULL,
  status VARCHAR(20) NOT NULL DEFAULT 'waiting' 
    CHECK (status IN ('waiting', 'playing', 'finished')),
  is_public BOOLEAN NOT NULL DEFAULT true,
  word_pack_id UUID REFERENCES word_packs(id),
  current_turn VARCHAR(10) CHECK (current_turn IN ('red', 'blue')),
  winner VARCHAR(10) CHECK (winner IN ('red', 'blue')),
  current_hint_word VARCHAR(100),
  current_hint_count INTEGER,
  guesses_left INTEGER,
  timer_seconds INTEGER,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE players (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id UUID NOT NULL REFERENCES rooms(id) ON DELETE CASCADE,
  nickname VARCHAR(50) NOT NULL,
  team VARCHAR(20) NOT NULL DEFAULT 'spectator'
    CHECK (team IN ('red', 'blue', 'spectator')),
  role VARCHAR(20) CHECK (role IN ('spymaster', 'operative')),
  is_host BOOLEAN NOT NULL DEFAULT false,
  spectator_view VARCHAR(20) DEFAULT 'operative'
    CHECK (spectator_view IN ('spymaster', 'operative')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ã‚«ãƒ¼ãƒ‰ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE cards (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id UUID NOT NULL REFERENCES rooms(id) ON DELETE CASCADE,
  word VARCHAR(100) NOT NULL,
  position INTEGER NOT NULL CHECK (position >= 0 AND position <= 24),
  type VARCHAR(20) NOT NULL 
    CHECK (type IN ('red', 'blue', 'neutral', 'assassin')),
  is_revealed BOOLEAN NOT NULL DEFAULT false,
  revealed_by UUID REFERENCES players(id),
  UNIQUE(room_id, position)
);

-- ãƒ’ãƒ³ãƒˆå±¥æ­´ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE hints (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id UUID NOT NULL REFERENCES rooms(id) ON DELETE CASCADE,
  player_id UUID NOT NULL REFERENCES players(id),
  word VARCHAR(100) NOT NULL,
  count INTEGER NOT NULL,
  team VARCHAR(10) NOT NULL CHECK (team IN ('red', 'blue')),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- å˜èªãƒ‘ãƒƒã‚¯ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE word_packs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  description TEXT,
  is_public BOOLEAN NOT NULL DEFAULT false,
  is_default BOOLEAN NOT NULL DEFAULT false,
  language VARCHAR(10) NOT NULL DEFAULT 'ja',
  creator_id VARCHAR(255),  -- ã‚²ã‚¹ãƒˆãªã®ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³IDç­‰
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- å˜èªãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE words (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  word_pack_id UUID NOT NULL REFERENCES word_packs(id) ON DELETE CASCADE,
  word VARCHAR(100) NOT NULL
);

-- ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆä»»æ„æ©Ÿèƒ½ï¼‰
CREATE TABLE chat_messages (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  room_id UUID NOT NULL REFERENCES rooms(id) ON DELETE CASCADE,
  player_id UUID NOT NULL REFERENCES players(id),
  message TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_rooms_code ON rooms(code);
CREATE INDEX idx_rooms_is_public ON rooms(is_public);
CREATE INDEX idx_rooms_updated_at ON rooms(updated_at);
CREATE INDEX idx_players_room_id ON players(room_id);
CREATE INDEX idx_cards_room_id ON cards(room_id);
CREATE INDEX idx_words_word_pack_id ON words(word_pack_id);
CREATE INDEX idx_word_packs_is_public ON word_packs(is_public);

-- updated_atè‡ªå‹•æ›´æ–°ãƒˆãƒªã‚¬ãƒ¼
CREATE OR REPLACE FUNCTION update_updated_at()
RETURNS TRIGGER AS $$
BEGIN
  NEW.updated_at = NOW();
  RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER rooms_updated_at
  BEFORE UPDATE ON rooms
  FOR EACH ROW
  EXECUTE FUNCTION update_updated_at();
```

### 4.3 Row Level Security (RLS)

```sql
-- RLSã‚’æœ‰åŠ¹åŒ–
ALTER TABLE rooms ENABLE ROW LEVEL SECURITY;
ALTER TABLE players ENABLE ROW LEVEL SECURITY;
ALTER TABLE cards ENABLE ROW LEVEL SECURITY;
ALTER TABLE hints ENABLE ROW LEVEL SECURITY;
ALTER TABLE word_packs ENABLE ROW LEVEL SECURITY;
ALTER TABLE words ENABLE ROW LEVEL SECURITY;
ALTER TABLE chat_messages ENABLE ROW LEVEL SECURITY;

-- ãƒ«ãƒ¼ãƒ : èª°ã§ã‚‚å‚ç…§å¯èƒ½ã€ä½œæˆå¯èƒ½
CREATE POLICY "rooms_select" ON rooms FOR SELECT USING (true);
CREATE POLICY "rooms_insert" ON rooms FOR INSERT WITH CHECK (true);
CREATE POLICY "rooms_update" ON rooms FOR UPDATE USING (true);
CREATE POLICY "rooms_delete" ON rooms FOR DELETE USING (true);

-- ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼: èª°ã§ã‚‚æ“ä½œå¯èƒ½
CREATE POLICY "players_all" ON players FOR ALL USING (true);

-- ã‚«ãƒ¼ãƒ‰: èª°ã§ã‚‚å‚ç…§å¯èƒ½ã€ã‚²ãƒ¼ãƒ ä¸­ã®æ“ä½œã¯ã‚¢ãƒ—ãƒªå´ã§åˆ¶å¾¡
CREATE POLICY "cards_all" ON cards FOR ALL USING (true);

-- ãƒ’ãƒ³ãƒˆ: èª°ã§ã‚‚æ“ä½œå¯èƒ½
CREATE POLICY "hints_all" ON hints FOR ALL USING (true);

-- å˜èªãƒ‘ãƒƒã‚¯: å…¬é–‹ãƒ‘ãƒƒã‚¯ã¯èª°ã§ã‚‚å‚ç…§å¯èƒ½
CREATE POLICY "word_packs_select" ON word_packs FOR SELECT USING (true);
CREATE POLICY "word_packs_insert" ON word_packs FOR INSERT WITH CHECK (true);
CREATE POLICY "word_packs_update" ON word_packs FOR UPDATE USING (true);
CREATE POLICY "word_packs_delete" ON word_packs FOR DELETE USING (true);

-- å˜èª: ãƒ‘ãƒƒã‚¯ã«ç´ã¥ã„ã¦æ“ä½œ
CREATE POLICY "words_all" ON words FOR ALL USING (true);

-- ãƒãƒ£ãƒƒãƒˆ: ãƒ«ãƒ¼ãƒ ã®ãƒ¡ãƒ³ãƒãƒ¼ã®ã¿
CREATE POLICY "chat_all" ON chat_messages FOR ALL USING (true);
```

### 4.4 ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ç”¨SQLé–¢æ•°

```sql
-- 12æ™‚é–“ä»¥ä¸Šéã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ«ãƒ¼ãƒ ã‚’å‰Šé™¤
CREATE OR REPLACE FUNCTION cleanup_inactive_rooms()
RETURNS INTEGER AS $$
DECLARE
  deleted_count INTEGER;
BEGIN
  DELETE FROM rooms 
  WHERE updated_at < NOW() - INTERVAL '12 hours';
  
  GET DIAGNOSTICS deleted_count = ROW_COUNT;
  RETURN deleted_count;
END;
$$ LANGUAGE plpgsql;

-- Supabase Cron (pg_cron) ã§å®šæœŸå®Ÿè¡Œ
-- SELECT cron.schedule('cleanup-rooms', '0 * * * *', 'SELECT cleanup_inactive_rooms()');
```

---

## 5. Supabase Realtime è¨­è¨ˆ

### 5.1 ãƒãƒ£ãƒ³ãƒãƒ«æ§‹æˆ

| ãƒãƒ£ãƒ³ãƒãƒ«å | ç”¨é€” | ã‚¿ã‚¤ãƒ— |
|-------------|------|--------|
| `room:{roomId}` | ãƒ«ãƒ¼ãƒ å†…ã®ã‚²ãƒ¼ãƒ ã‚¤ãƒ™ãƒ³ãƒˆ | Broadcast |
| `room:{roomId}:presence` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ | Presence |

### 5.2 Broadcast ã‚¤ãƒ™ãƒ³ãƒˆ

#### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ â†’ ã‚µãƒ¼ãƒãƒ¼ï¼ˆä»–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰

| ã‚¤ãƒ™ãƒ³ãƒˆå | ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ | èª¬æ˜ |
|-----------|-----------|------|
| player_joined | `{ player }` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å‚åŠ  |
| player_left | `{ playerId }` | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é€€å‡º |
| team_changed | `{ playerId, team, role }` | ãƒãƒ¼ãƒ /å½¹å‰²å¤‰æ›´ |
| game_started | `{ cards, currentTurn }` | ã‚²ãƒ¼ãƒ é–‹å§‹ |
| hint_given | `{ hint }` | ãƒ’ãƒ³ãƒˆé€ä¿¡ |
| card_selected | `{ position, result }` | ã‚«ãƒ¼ãƒ‰é¸æŠçµæœ |
| turn_ended | `{ nextTurn }` | ã‚¿ãƒ¼ãƒ³çµ‚äº† |
| game_over | `{ winner }` | ã‚²ãƒ¼ãƒ çµ‚äº† |
| chat_message | `{ playerId, nickname, message }` | ãƒãƒ£ãƒƒãƒˆ |

### 5.3 Presence

```typescript
// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³çŠ¶æ…‹ã‚’è¿½è·¡
interface PresenceState {
  odenames-clone/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ tailwind.config.js
â”œâ”€â”€ index.html
â”œâ”€â”€ .env.local                    # Supabaseæ¥ç¶šæƒ…å ±
â”œâ”€â”€ .env.example
â”‚
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx
â”‚   â”œâ”€â”€ App.tsx
â”‚   â”œâ”€â”€ index.css
â”‚   â”‚
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ ui/                   # å…±é€šUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.tsx
â”‚   â”‚   â”‚   â””â”€â”€ Modal.tsx
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ game/                 # ã‚²ãƒ¼ãƒ é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ Board.tsx         # 5x5ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ GameCard.tsx      # å˜èªã‚«ãƒ¼ãƒ‰
â”‚   â”‚   â”‚   â”œâ”€â”€ HintInput.tsx     # ãƒ’ãƒ³ãƒˆå…¥åŠ›
â”‚   â”‚   â”‚   â”œâ”€â”€ HintDisplay.tsx   # ãƒ’ãƒ³ãƒˆè¡¨ç¤º
â”‚   â”‚   â”‚   â”œâ”€â”€ TeamScore.tsx     # ãƒãƒ¼ãƒ ã‚¹ã‚³ã‚¢
â”‚   â”‚   â”‚   â””â”€â”€ GameResult.tsx    # çµæœè¡¨ç¤º
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ room/                 # ãƒ«ãƒ¼ãƒ é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ PlayerList.tsx    # ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä¸€è¦§
â”‚   â”‚   â”‚   â”œâ”€â”€ TeamPanel.tsx     # ãƒãƒ¼ãƒ é¸æŠãƒ‘ãƒãƒ«
â”‚   â”‚   â”‚   â”œâ”€â”€ RoomSettings.tsx  # ãƒ«ãƒ¼ãƒ è¨­å®š
â”‚   â”‚   â”‚   â””â”€â”€ Chat.tsx          # ãƒãƒ£ãƒƒãƒˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ layout/               # ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚       â”œâ”€â”€ Header.tsx
â”‚   â”‚       â””â”€â”€ Layout.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ TopPage.tsx
â”‚   â”‚   â”œâ”€â”€ CreateRoomPage.tsx
â”‚   â”‚   â”œâ”€â”€ JoinRoomPage.tsx
â”‚   â”‚   â”œâ”€â”€ RoomListPage.tsx
â”‚   â”‚   â”œâ”€â”€ LobbyPage.tsx
â”‚   â”‚   â”œâ”€â”€ GamePage.tsx
â”‚   â”‚   â”œâ”€â”€ WordPackListPage.tsx
â”‚   â”‚   â”œâ”€â”€ WordPackCreatePage.tsx
â”‚   â”‚   â””â”€â”€ WordPackEditPage.tsx
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useSupabase.ts        # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ useRoom.ts            # ãƒ«ãƒ¼ãƒ æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ useGame.ts            # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ useRealtime.ts        # Realtimeè³¼èª­
â”‚   â”‚   â””â”€â”€ usePresence.ts        # Presenceç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                   # Zustand
â”‚   â”‚   â”œâ”€â”€ playerStore.ts        # è‡ªåˆ†ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æƒ…å ±
â”‚   â”‚   â”œâ”€â”€ roomStore.ts          # ãƒ«ãƒ¼ãƒ çŠ¶æ…‹
â”‚   â”‚   â””â”€â”€ gameStore.ts          # ã‚²ãƒ¼ãƒ çŠ¶æ…‹
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ supabase.ts           # Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–
â”‚   â”‚   â””â”€â”€ constants.ts          # å®šæ•°
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ roomService.ts        # ãƒ«ãƒ¼ãƒ CRUD
â”‚   â”‚   â”œâ”€â”€ gameService.ts        # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ wordPackService.ts    # å˜èªãƒ‘ãƒƒã‚¯CRUD
â”‚   â”‚   â””â”€â”€ realtimeService.ts    # Realtimeå‡¦ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”œâ”€â”€ database.ts           # Supabaseç”Ÿæˆå‹
â”‚   â”‚   â””â”€â”€ index.ts              # ã‚¢ãƒ—ãƒªå›ºæœ‰å‹
â”‚   â”‚
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ codeGenerator.ts      # ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ
â”‚       â”œâ”€â”€ cardGenerator.ts      # ã‚«ãƒ¼ãƒ‰é…ç½®ãƒ­ã‚¸ãƒƒã‚¯
â”‚       â””â”€â”€ helpers.ts
â”‚
â””â”€â”€ supabase/
    â”œâ”€â”€ config.toml               # Supabaseè¨­å®š
    â”œâ”€â”€ seed.sql                  # åˆæœŸãƒ‡ãƒ¼ã‚¿ï¼ˆå˜èª1000èªï¼‰
    â””â”€â”€ migrations/
        â””â”€â”€ 20250101000000_init.sql
```

---

## 7. å‹å®šç¾©

### 7.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‹ï¼ˆSupabaseç”Ÿæˆï¼‰

```typescript
// types/database.ts
// `supabase gen types typescript` ã§ç”Ÿæˆ

export interface Database {
  public: {
    Tables: {
      rooms: {
        Row: {
          id: string
          code: string
          name: string
          status: 'waiting' | 'playing' | 'finished'
          is_public: boolean
          word_pack_id: string | null
          current_turn: 'red' | 'blue' | null
          winner: 'red' | 'blue' | null
          current_hint_word: string | null
          current_hint_count: number | null
          guesses_left: number | null
          timer_seconds: number | null
          created_at: string
          updated_at: string
        }
        Insert: { ... }
        Update: { ... }
      }
      players: { ... }
      cards: { ... }
      hints: { ... }
      word_packs: { ... }
      words: { ... }
      chat_messages: { ... }
    }
  }
}
```

### 7.2 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å‹

```typescript
// types/index.ts

export type Team = 'red' | 'blue' | 'spectator'
export type Role = 'spymaster' | 'operative'
export type CardType = 'red' | 'blue' | 'neutral' | 'assassin'
export type RoomStatus = 'waiting' | 'playing' | 'finished'
export type SpectatorView = 'spymaster' | 'operative'

export interface Player {
  id: string
  roomId: string
  nickname: string
  team: Team
  role: Role | null
  isHost: boolean
  spectatorView: SpectatorView
  isOnline: boolean  // Presenceã‹ã‚‰
}

export interface Card {
  id: string
  word: string
  position: number
  type: CardType
  isRevealed: boolean
  revealedBy: string | null
}

export interface Hint {
  id: string
  playerId: string
  word: string
  count: number
  team: 'red' | 'blue'
  createdAt: string
}

export interface Room {
  id: string
  code: string
  name: string
  status: RoomStatus
  isPublic: boolean
  wordPackId: string | null
  currentTurn: 'red' | 'blue' | null
  winner: 'red' | 'blue' | null
  currentHint: { word: string; count: number } | null
  guessesLeft: number | null
  timerSeconds: number | null
  players: Player[]
  cards: Card[]
  hints: Hint[]
}

export interface WordPack {
  id: string
  name: string
  description: string | null
  isPublic: boolean
  isDefault: boolean
  language: string
  wordCount: number
}

// Realtimeã‚¤ãƒ™ãƒ³ãƒˆ
export type RealtimeEvent = 
  | { type: 'player_joined'; player: Player }
  | { type: 'player_left'; playerId: string }
  | { type: 'team_changed'; playerId: string; team: Team; role: Role | null }
  | { type: 'game_started'; cards: Card[]; currentTurn: 'red' | 'blue' }
  | { type: 'hint_given'; hint: Hint }
  | { type: 'card_selected'; position: number; card: Card; nextTurn?: 'red' | 'blue'; gameOver?: boolean; winner?: 'red' | 'blue' }
  | { type: 'turn_ended'; nextTurn: 'red' | 'blue' }
  | { type: 'game_over'; winner: 'red' | 'blue' }
  | { type: 'chat_message'; playerId: string; nickname: string; message: string; timestamp: string }
```

---

## 8. ä¸»è¦ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…

### 8.1 Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–

```typescript
// lib/supabase.ts
import { createClient } from '@supabase/supabase-js'
import type { Database } from '@/types/database'

const supabaseUrl = import.meta.env.VITE_SUPABASE_URL
const supabaseAnonKey = import.meta.env.VITE_SUPABASE_ANON_KEY

export const supabase = createClient<Database>(supabaseUrl, supabaseAnonKey)
```

### 8.2 ãƒ«ãƒ¼ãƒ ã‚µãƒ¼ãƒ“ã‚¹

```typescript
// services/roomService.ts
import { supabase } from '@/lib/supabase'
import { generateRoomCode } from '@/utils/codeGenerator'

export const roomService = {
  // ãƒ«ãƒ¼ãƒ ä½œæˆ
  async createRoom(params: {
    name: string
    isPublic: boolean
    wordPackId: string
    hostNickname: string
    timerSeconds?: number
  }) {
    const code = generateRoomCode()
    
    // ãƒ«ãƒ¼ãƒ ä½œæˆ
    const { data: room, error: roomError } = await supabase
      .from('rooms')
      .insert({
        code,
        name: params.name,
        is_public: params.isPublic,
        word_pack_id: params.wordPackId,
        timer_seconds: params.timerSeconds ?? null,
      })
      .select()
      .single()
    
    if (roomError) throw roomError
    
    // ãƒ›ã‚¹ãƒˆãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä½œæˆ
    const { data: player, error: playerError } = await supabase
      .from('players')
      .insert({
        room_id: room.id,
        nickname: params.hostNickname,
        is_host: true,
      })
      .select()
      .single()
    
    if (playerError) throw playerError
    
    return { room, player }
  },

  // å…¬é–‹ãƒ«ãƒ¼ãƒ ä¸€è¦§
  async getPublicRooms() {
    const { data, error } = await supabase
      .from('rooms')
      .select(`
        *,
        players(count)
      `)
      .eq('is_public', true)
      .eq('status', 'waiting')
      .order('created_at', { ascending: false })
    
    if (error) throw error
    return data
  },

  // ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã§å–å¾—
  async getRoomByCode(code: string) {
    const { data, error } = await supabase
      .from('rooms')
      .select(`
        *,
        players(*),
        cards(*),
        hints(*)
      `)
      .eq('code', code.toUpperCase())
      .single()
    
    if (error) throw error
    return data
  },

  // ãƒ«ãƒ¼ãƒ å‚åŠ 
  async joinRoom(roomId: string, nickname: string) {
    // äººæ•°ãƒã‚§ãƒƒã‚¯
    const { count } = await supabase
      .from('players')
      .select('*', { count: 'exact', head: true })
      .eq('room_id', roomId)
    
    if (count && count >= 12) {
      throw new Error('ãƒ«ãƒ¼ãƒ ãŒæº€å“¡ã§ã™')
    }
    
    const { data, error } = await supabase
      .from('players')
      .insert({
        room_id: roomId,
        nickname,
      })
      .select()
      .single()
    
    if (error) throw error
    return data
  },

  // ãƒãƒ¼ãƒ /å½¹å‰²å¤‰æ›´
  async updatePlayer(playerId: string, updates: {
    team?: 'red' | 'blue' | 'spectator'
    role?: 'spymaster' | 'operative' | null
    spectatorView?: 'spymaster' | 'operative'
  }) {
    const { data, error } = await supabase
      .from('players')
      .update(updates)
      .eq('id', playerId)
      .select()
      .single()
    
    if (error) throw error
    return data
  },

  // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼é€€å‡º
  async leaveRoom(playerId: string) {
    const { error } = await supabase
      .from('players')
      .delete()
      .eq('id', playerId)
    
    if (error) throw error
  },
}
```

### 8.3 ã‚²ãƒ¼ãƒ ã‚µãƒ¼ãƒ“ã‚¹

```typescript
// services/gameService.ts
import { supabase } from '@/lib/supabase'
import { generateCards } from '@/utils/cardGenerator'

export const gameService = {
  // ã‚²ãƒ¼ãƒ é–‹å§‹
  async startGame(roomId: string, wordPackId: string) {
    // å˜èªå–å¾—
    const { data: words } = await supabase
      .from('words')
      .select('word')
      .eq('word_pack_id', wordPackId)
    
    if (!words || words.length < 25) {
      throw new Error('å˜èªãŒä¸è¶³ã—ã¦ã„ã¾ã™')
    }
    
    // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
    const cards = generateCards(words.map(w => w.word))
    
    // ã‚«ãƒ¼ãƒ‰æŒ¿å…¥
    const { error: cardsError } = await supabase
      .from('cards')
      .insert(cards.map((card, index) => ({
        room_id: roomId,
        word: card.word,
        position: index,
        type: card.type,
      })))
    
    if (cardsError) throw cardsError
    
    // ãƒ«ãƒ¼ãƒ çŠ¶æ…‹æ›´æ–°
    const { error: roomError } = await supabase
      .from('rooms')
      .update({
        status: 'playing',
        current_turn: 'red',  // èµ¤å…ˆæ”»
      })
      .eq('id', roomId)
    
    if (roomError) throw roomError
    
    return cards
  },

  // ãƒ’ãƒ³ãƒˆé€ä¿¡
  async giveHint(roomId: string, playerId: string, word: string, count: number, team: 'red' | 'blue') {
    // ãƒ’ãƒ³ãƒˆè¨˜éŒ²
    const { error: hintError } = await supabase
      .from('hints')
      .insert({
        room_id: roomId,
        player_id: playerId,
        word,
        count,
        team,
      })
    
    if (hintError) throw hintError
    
    // ãƒ«ãƒ¼ãƒ æ›´æ–°ï¼ˆç¾åœ¨ã®ãƒ’ãƒ³ãƒˆã€æ®‹ã‚Šæ¨æ¸¬å›æ•°ï¼‰
    const { error: roomError } = await supabase
      .from('rooms')
      .update({
        current_hint_word: word,
        current_hint_count: count,
        guesses_left: count + 1,  // ãƒ’ãƒ³ãƒˆæ•° + 1å›
      })
      .eq('id', roomId)
    
    if (roomError) throw roomError
  },

  // ã‚«ãƒ¼ãƒ‰é¸æŠ
  async selectCard(roomId: string, playerId: string, position: number) {
    // ã‚«ãƒ¼ãƒ‰å–å¾—
    const { data: card } = await supabase
      .from('cards')
      .select('*')
      .eq('room_id', roomId)
      .eq('position', position)
      .single()
    
    if (!card || card.is_revealed) {
      throw new Error('ç„¡åŠ¹ãªã‚«ãƒ¼ãƒ‰ã§ã™')
    }
    
    // ã‚«ãƒ¼ãƒ‰å…¬é–‹
    await supabase
      .from('cards')
      .update({
        is_revealed: true,
        revealed_by: playerId,
      })
      .eq('id', card.id)
    
    // ãƒ«ãƒ¼ãƒ çŠ¶æ…‹å–å¾—
    const { data: room } = await supabase
      .from('rooms')
      .select('*, cards(*)')
      .eq('id', roomId)
      .single()
    
    // å‹æ•—åˆ¤å®š
    const result = this.checkGameResult(room, card)
    
    if (result.gameOver) {
      await supabase
        .from('rooms')
        .update({
          status: 'finished',
          winner: result.winner,
        })
        .eq('id', roomId)
    } else if (result.turnEnded) {
      const nextTurn = room.current_turn === 'red' ? 'blue' : 'red'
      await supabase
        .from('rooms')
        .update({
          current_turn: nextTurn,
          current_hint_word: null,
          current_hint_count: null,
          guesses_left: null,
        })
        .eq('id', roomId)
    } else {
      // æ¨æ¸¬ç¶™ç¶š
      await supabase
        .from('rooms')
        .update({
          guesses_left: (room.guesses_left ?? 1) - 1,
        })
        .eq('id', roomId)
    }
    
    return { card, ...result }
  },

  // ã‚¿ãƒ¼ãƒ³çµ‚äº†ï¼ˆãƒ‘ã‚¹ï¼‰
  async endTurn(roomId: string) {
    const { data: room } = await supabase
      .from('rooms')
      .select('current_turn')
      .eq('id', roomId)
      .single()
    
    const nextTurn = room?.current_turn === 'red' ? 'blue' : 'red'
    
    await supabase
      .from('rooms')
      .update({
        current_turn: nextTurn,
        current_hint_word: null,
        current_hint_count: null,
        guesses_left: null,
      })
      .eq('id', roomId)
    
    return nextTurn
  },

  // å‹æ•—åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
  checkGameResult(room: any, selectedCard: any) {
    const cards = room.cards
    const currentTurn = room.current_turn
    
    // æš—æ®ºè€… â†’ å³æ•—åŒ—
    if (selectedCard.type === 'assassin') {
      return {
        gameOver: true,
        winner: currentTurn === 'red' ? 'blue' : 'red',
        turnEnded: true,
      }
    }
    
    // å…¨ã‚«ãƒ¼ãƒ‰å…¬é–‹ãƒã‚§ãƒƒã‚¯
    const redRevealed = cards.filter((c: any) => c.type === 'red' && c.is_revealed).length
    const blueRevealed = cards.filter((c: any) => c.type === 'blue' && c.is_revealed).length
    
    // è‡ªãƒãƒ¼ãƒ å…¨å…¬é–‹ â†’ å‹åˆ©ï¼ˆé¸æŠã—ãŸã‚«ãƒ¼ãƒ‰å«ã‚€ï¼‰
    const newRedRevealed = selectedCard.type === 'red' ? redRevealed + 1 : redRevealed
    const newBlueRevealed = selectedCard.type === 'blue' ? blueRevealed + 1 : blueRevealed
    
    if (newRedRevealed === 9) {
      return { gameOver: true, winner: 'red' as const, turnEnded: true }
    }
    if (newBlueRevealed === 8) {
      return { gameOver: true, winner: 'blue' as const, turnEnded: true }
    }
    
    // ç›¸æ‰‹ãƒãƒ¼ãƒ ã¾ãŸã¯ä¸­ç«‹ â†’ ã‚¿ãƒ¼ãƒ³çµ‚äº†
    if (selectedCard.type !== currentTurn) {
      return { gameOver: false, turnEnded: true }
    }
    
    // è‡ªãƒãƒ¼ãƒ  â†’ æ¨æ¸¬ç¶™ç¶šï¼ˆæ®‹ã‚Šå›æ•°ãƒã‚§ãƒƒã‚¯ï¼‰
    if ((room.guesses_left ?? 1) <= 1) {
      return { gameOver: false, turnEnded: true }
    }
    
    return { gameOver: false, turnEnded: false }
  },

  // å†æˆ¦
  async restartGame(roomId: string, wordPackId: string) {
    // å¤ã„ã‚«ãƒ¼ãƒ‰å‰Šé™¤
    await supabase.from('cards').delete().eq('room_id', roomId)
    await supabase.from('hints').delete().eq('room_id', roomId)
    
    // ãƒ«ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
    await supabase
      .from('rooms')
      .update({
        status: 'waiting',
        current_turn: null,
        winner: null,
        current_hint_word: null,
        current_hint_count: null,
        guesses_left: null,
      })
      .eq('id', roomId)
  },
}
```

### 8.4 Realtimeã‚µãƒ¼ãƒ“ã‚¹

```typescript
// services/realtimeService.ts
import { supabase } from '@/lib/supabase'
import type { RealtimeChannel } from '@supabase/supabase-js'

export const realtimeService = {
  channel: null as RealtimeChannel | null,

  // ãƒ«ãƒ¼ãƒ ã«æ¥ç¶š
  joinRoom(roomId: string, player: { id: string; nickname: string }) {
    this.channel = supabase.channel(`room:${roomId}`, {
      config: {
        presence: { key: player.id },
      },
    })

    // Presenceè¨­å®š
    this.channel.on('presence', { event: 'sync' }, () => {
      const state = this.channel?.presenceState()
      console.log('Presence sync:', state)
    })

    this.channel.on('presence', { event: 'join' }, ({ key, newPresences }) => {
      console.log('Player joined:', key, newPresences)
    })

    this.channel.on('presence', { event: 'leave' }, ({ key, leftPresences }) => {
      console.log('Player left:', key, leftPresences)
    })

    // è³¼èª­é–‹å§‹
    this.channel.subscribe(async (status) => {
      if (status === 'SUBSCRIBED') {
        await this.channel?.track({
          id: player.id,
          nickname: player.nickname,
          online_at: new Date().toISOString(),
        })
      }
    })

    return this.channel
  },

  // ã‚¤ãƒ™ãƒ³ãƒˆé€ä¿¡
  broadcast(event: string, payload: any) {
    this.channel?.send({
      type: 'broadcast',
      event,
      payload,
    })
  },

  // ã‚¤ãƒ™ãƒ³ãƒˆè³¼èª­
  onBroadcast(event: string, callback: (payload: any) => void) {
    this.channel?.on('broadcast', { event }, ({ payload }) => {
      callback(payload)
    })
  },

  // DBå¤‰æ›´è³¼èª­
  onTableChange(table: string, filter: string, callback: (payload: any) => void) {
    this.channel?.on(
      'postgres_changes',
      { event: '*', schema: 'public', table, filter },
      callback
    )
  },

  // åˆ‡æ–­
  leave() {
    if (this.channel) {
      supabase.removeChannel(this.channel)
      this.channel = null
    }
  },
}
```

---

## 9. ç”»é¢è¨­è¨ˆ

### 9.1 ç”»é¢ä¸€è¦§

| ç”»é¢ID | ç”»é¢å | ãƒ‘ã‚¹ | èª¬æ˜ |
|--------|--------|------|------|
| S-01 | ãƒˆãƒƒãƒ— | / | ãƒ«ãƒ¼ãƒ ä½œæˆãƒ»å‚åŠ ã®å…¥ã‚Šå£ |
| S-02 | ãƒ«ãƒ¼ãƒ ä½œæˆ | /create | ãƒ«ãƒ¼ãƒ è¨­å®šå…¥åŠ› |
| S-03 | ãƒ«ãƒ¼ãƒ å‚åŠ  | /join | ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰å…¥åŠ› |
| S-04 | å…¬é–‹ãƒ«ãƒ¼ãƒ ä¸€è¦§ | /rooms | å…¬é–‹ãƒ«ãƒ¼ãƒ ã®ä¸€è¦§ |
| S-05 | ãƒ­ãƒ“ãƒ¼ | /room/:code | ã‚²ãƒ¼ãƒ é–‹å§‹å‰ã®å¾…æ©Ÿç”»é¢ |
| S-06 | ã‚²ãƒ¼ãƒ  | /room/:code/game | ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ã‚¤ç”»é¢ |
| S-07 | å˜èªãƒ‘ãƒƒã‚¯ä¸€è¦§ | /word-packs | ãƒ‘ãƒƒã‚¯ä¸€è¦§ãƒ»ç®¡ç† |
| S-08 | å˜èªãƒ‘ãƒƒã‚¯ä½œæˆ | /word-packs/create | æ–°è¦ãƒ‘ãƒƒã‚¯ä½œæˆ |
| S-09 | å˜èªãƒ‘ãƒƒã‚¯ç·¨é›† | /word-packs/:id/edit | ãƒ‘ãƒƒã‚¯ç·¨é›† |

### 9.2 ç”»é¢è©³ç´°

#### S-01: ãƒˆãƒƒãƒ—ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                             â”‚
â”‚             ğŸ¯ CODENAMES                    â”‚
â”‚                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚      ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã™ã‚‹           â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚      ãƒ«ãƒ¼ãƒ ã«å‚åŠ ã™ã‚‹           â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚      å…¬é–‹ãƒ«ãƒ¼ãƒ ä¸€è¦§             â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚      å˜èªãƒ‘ãƒƒã‚¯ç®¡ç†             â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S-05: ãƒ­ãƒ“ãƒ¼ç”»é¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒ«ãƒ¼ãƒ : å‹é”ã¨ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ           ã‚³ãƒ¼ãƒ‰: ABC123   [ã‚³ãƒ”ãƒ¼]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚      ğŸ”´ èµ¤ãƒãƒ¼ãƒ      â”‚       â”‚      ğŸ”µ é’ãƒãƒ¼ãƒ      â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ ğŸ‘‘ ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼    â”‚       â”‚ ğŸ‘‘ ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼    â”‚          â”‚
â”‚  â”‚   å¤ªéƒ â—            â”‚       â”‚   (ç©ºã)            â”‚          â”‚
â”‚  â”‚ [é¸æŠ]              â”‚       â”‚   [é¸æŠ]            â”‚          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚ ğŸ” ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–    â”‚       â”‚ ğŸ” ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–    â”‚          â”‚
â”‚  â”‚   èŠ±å­ â—            â”‚       â”‚   æ¬¡éƒ â—            â”‚          â”‚
â”‚  â”‚   [é¸æŠ]            â”‚       â”‚   [é¸æŠ]            â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ ğŸ‘ è¦³æˆ¦è€…: å±±ç”° â—                                    â”‚        â”‚
â”‚  â”‚ ãƒ“ãƒ¥ãƒ¼: [ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ â–¼]                           â”‚        â”‚
â”‚  â”‚ [è¦³æˆ¦è€…ã«ãªã‚‹]                                       â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  â— = ã‚ªãƒ³ãƒ©ã‚¤ãƒ³                                                 â”‚
â”‚  å˜èªãƒ‘ãƒƒã‚¯: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥æœ¬èª                                    â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚              ğŸ® ã‚²ãƒ¼ãƒ ã‚’é–‹å§‹ã™ã‚‹                     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S-06: ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ èµ¤: 6/9    ğŸ”µ é’: 5/8    ã‚¿ãƒ¼ãƒ³: ğŸ”´èµ¤ãƒãƒ¼ãƒ                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ãƒ’ãƒ³ãƒˆ: ã€Œå‹•ç‰© 3ã€ (æ®‹ã‚Šæ¨æ¸¬: 2)                                â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚         â”‚  ğŸ”´     â”‚         â”‚         â”‚  ğŸ”µ     â”‚           â”‚
â”‚  â”‚  ã‚Šã‚“ã”  â”‚  æ±äº¬   â”‚  é›»è»Š   â”‚  çŒ«     â”‚  æµ·    â”‚           â”‚
â”‚  â”‚         â”‚(å…¬é–‹æ¸ˆ) â”‚         â”‚         â”‚(å…¬é–‹æ¸ˆ) â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚         â”‚         â”‚         â”‚  ğŸ”´     â”‚         â”‚           â”‚
â”‚  â”‚  å±±     â”‚  æœ¬     â”‚  æœˆ    â”‚  èŠ±     â”‚  ç©º     â”‚           â”‚
â”‚  â”‚         â”‚         â”‚         â”‚(å…¬é–‹æ¸ˆ) â”‚         â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚  ğŸ”µ     â”‚         â”‚         â”‚         â”‚  â¬œ     â”‚           â”‚
â”‚  â”‚  æ°´     â”‚  ç«     â”‚  æœ¨     â”‚  é‡‘     â”‚  åœŸ     â”‚           â”‚
â”‚  â”‚(å…¬é–‹æ¸ˆ) â”‚         â”‚         â”‚         â”‚(ä¸­ç«‹)   â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚         â”‚  ğŸ”´     â”‚         â”‚         â”‚         â”‚           â”‚
â”‚  â”‚  é›¨     â”‚  é›ª     â”‚  é¢¨     â”‚  é›²     â”‚  è™¹     â”‚           â”‚
â”‚  â”‚         â”‚(å…¬é–‹æ¸ˆ) â”‚         â”‚         â”‚         â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚         â”‚         â”‚  ğŸ”µ     â”‚         â”‚         â”‚           â”‚
â”‚  â”‚  æ˜Ÿ     â”‚  æœˆ     â”‚  å¤ªé™½   â”‚  åœ°çƒ   â”‚  å®‡å®™   â”‚           â”‚
â”‚  â”‚         â”‚         â”‚(å…¬é–‹æ¸ˆ) â”‚         â”‚         â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚              ã‚¿ãƒ¼ãƒ³çµ‚äº†ï¼ˆãƒ‘ã‚¹ï¼‰                       â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### S-06: ã‚²ãƒ¼ãƒ ç”»é¢ï¼ˆã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¼ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ èµ¤: 6/9    ğŸ”µ é’: 5/8    ã‚¿ãƒ¼ãƒ³: ğŸ”´èµ¤ãƒãƒ¼ãƒ ï¼ˆã‚ãªãŸï¼‰        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  â¬œ     â”‚  ğŸ”´     â”‚  ğŸ”´     â”‚  ğŸ”µ     â”‚  ğŸ”µ     â”‚           â”‚
â”‚  â”‚  ã‚Šã‚“ã”  â”‚  æ±äº¬   â”‚  é›»è»Š   â”‚  çŒ«     â”‚  æµ·    â”‚           â”‚
â”‚  â”‚ neutral â”‚ å…¬é–‹æ¸ˆ  â”‚  red    â”‚  blue   â”‚ å…¬é–‹æ¸ˆ  â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚  ğŸ”µ     â”‚  ğŸ”´     â”‚  â¬›     â”‚  ğŸ”´     â”‚  â¬œ     â”‚           â”‚
â”‚  â”‚  å±±     â”‚  æœ¬     â”‚  æœˆ    â”‚  èŠ±     â”‚  ç©º     â”‚           â”‚
â”‚  â”‚  blue   â”‚  red    â”‚assassin â”‚ å…¬é–‹æ¸ˆ  â”‚ neutral â”‚           â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚
â”‚  â”‚  ğŸ”µ     â”‚  â¬œ     â”‚  ğŸ”´     â”‚  ğŸ”µ     â”‚  â¬œ     â”‚           â”‚
â”‚  â”‚  æ°´     â”‚  ç«     â”‚  æœ¨     â”‚  é‡‘     â”‚  åœŸ     â”‚           â”‚
â”‚  â”‚ å…¬é–‹æ¸ˆ  â”‚ neutral â”‚  red    â”‚  blue   â”‚ å…¬é–‹æ¸ˆ  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚  (ä»¥ä¸‹ç•¥)                                                       â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ãƒ’ãƒ³ãƒˆ: [          ]  æ•°å­—: [â–¼]  [ãƒ’ãƒ³ãƒˆã‚’é€ä¿¡]           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 10. ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯è©³ç´°

### 10.1 ã‚²ãƒ¼ãƒ é–‹å§‹æ¡ä»¶
- ä¸¡ãƒãƒ¼ãƒ ã«æœ€ä½1äººãšã¤ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒã„ã‚‹
- ä¸¡ãƒãƒ¼ãƒ ã«ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãŒ1äººãšã¤ã„ã‚‹
- ãƒ›ã‚¹ãƒˆã®ã¿ãŒã‚²ãƒ¼ãƒ é–‹å§‹å¯èƒ½

### 10.2 ã‚«ãƒ¼ãƒ‰é…ç½®ç”Ÿæˆ

```typescript
// utils/cardGenerator.ts

import type { CardType } from '@/types'

interface GeneratedCard {
  word: string
  type: CardType
}

export function generateCards(words: string[]): GeneratedCard[] {
  // ãƒ©ãƒ³ãƒ€ãƒ ã«25èªé¸æŠ
  const shuffledWords = [...words].sort(() => Math.random() - 0.5)
  const selectedWords = shuffledWords.slice(0, 25)
  
  // ã‚«ãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ—ã®é…åˆ—ã‚’ä½œæˆ
  const types: CardType[] = [
    ...Array(9).fill('red'),      // èµ¤9æšï¼ˆå…ˆæ”»ï¼‰
    ...Array(8).fill('blue'),     // é’8æš
    ...Array(7).fill('neutral'),  // ä¸­ç«‹7æš
    'assassin',                   // æš—æ®ºè€…1æš
  ]
  
  // ã‚¿ã‚¤ãƒ—ã‚’ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  const shuffledTypes = types.sort(() => Math.random() - 0.5)
  
  // ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
  return selectedWords.map((word, index) => ({
    word,
    type: shuffledTypes[index],
  }))
}
```

### 10.3 ã‚¿ãƒ¼ãƒ³é€²è¡Œ
1. ã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ãŒãƒ’ãƒ³ãƒˆï¼ˆå˜èª + æ•°å­—ï¼‰ã‚’å…¥åŠ›
2. ã‚ªãƒšãƒ¬ãƒ¼ãƒ†ã‚£ãƒ–ãŒã‚«ãƒ¼ãƒ‰ã‚’é¸æŠ
3. ã‚«ãƒ¼ãƒ‰çµæœã«å¿œã˜ã¦:
   - è‡ªãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ â†’ æ¨æ¸¬ç¶™ç¶šå¯èƒ½ï¼ˆæ®‹ã‚Šå›æ•°-1ï¼‰
   - ç›¸æ‰‹ãƒãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ â†’ ã‚¿ãƒ¼ãƒ³çµ‚äº†
   - ä¸€èˆ¬å¸‚æ°‘ â†’ ã‚¿ãƒ¼ãƒ³çµ‚äº†
   - æš—æ®ºè€… â†’ å³æ•—åŒ—
4. æ¨æ¸¬å›æ•°ã¯ã€Œãƒ’ãƒ³ãƒˆã®æ•°å­— + 1ã€ã¾ã§
5. ãƒ‘ã‚¹ã§ã‚¿ãƒ¼ãƒ³çµ‚äº†

### 10.4 å‹åˆ©æ¡ä»¶
- è‡ªãƒãƒ¼ãƒ ã®ã‚«ãƒ¼ãƒ‰ã‚’å…¨ã¦å…¬é–‹
- ç›¸æ‰‹ãƒãƒ¼ãƒ ãŒæš—æ®ºè€…ã‚’é¸æŠ

### 10.5 ãƒ’ãƒ³ãƒˆã®ãƒ«ãƒ¼ãƒ«ï¼ˆUIã§æ¡ˆå†…ï¼‰
- ãƒœãƒ¼ãƒ‰ä¸Šã®å˜èªã¯ä½¿ç”¨ä¸å¯
- æ•°å­—ã®ã¿ã®ãƒ’ãƒ³ãƒˆã¯ä¸å¯
- ã€Œ0ã€ã¯ã€Œé–¢é€£ãªã—ã€å¥½ãã«æ¨æ¸¬ã—ã¦ã€ã®æ„å‘³
- ã€Œâˆï¼ˆç„¡åˆ¶é™ï¼‰ã€ã‚‚é¸æŠå¯èƒ½

---

## 11. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 11.1 ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰

| ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|--------|------|
| ROOM_NOT_FOUND | ãƒ«ãƒ¼ãƒ ãŒå­˜åœ¨ã—ãªã„ |
| ROOM_FULL | ãƒ«ãƒ¼ãƒ ãŒæº€å“¡ï¼ˆ12äººï¼‰ |
| GAME_ALREADY_STARTED | ã‚²ãƒ¼ãƒ ã¯æ—¢ã«é–‹å§‹æ¸ˆã¿ |
| NOT_YOUR_TURN | ã‚ãªãŸã®ã‚¿ãƒ¼ãƒ³ã§ã¯ãªã„ |
| INVALID_ROLE | ã“ã®æ“ä½œã‚’è¡Œã†æ¨©é™ãŒãªã„ |
| INVALID_HINT | ç„¡åŠ¹ãªãƒ’ãƒ³ãƒˆ |
| WORD_PACK_NOT_FOUND | å˜èªãƒ‘ãƒƒã‚¯ãŒå­˜åœ¨ã—ãªã„ |
| INSUFFICIENT_WORDS | å˜èªãƒ‘ãƒƒã‚¯ã®å˜èªæ•°ãŒ25æœªæº€ |
| INVALID_CARD | ç„¡åŠ¹ãªã‚«ãƒ¼ãƒ‰é¸æŠ |

---

## 12. ç’°å¢ƒå¤‰æ•°

```env
# .env.local
VITE_SUPABASE_URL=https://your-project.supabase.co
VITE_SUPABASE_ANON_KEY=your-anon-key
```

---

## 13. ãƒ‡ãƒ—ãƒ­ã‚¤

### 13.1 Supabaseè¨­å®š
1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
2. SQLã‚¹ã‚­ãƒ¼ãƒå®Ÿè¡Œï¼ˆãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
3. seed.sqlå®Ÿè¡Œï¼ˆåˆæœŸå˜èªãƒ‡ãƒ¼ã‚¿ï¼‰
4. Realtimeæœ‰åŠ¹åŒ–ï¼ˆrooms, players, cards, hints ãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰
5. pg_cronã§ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¸ãƒ§ãƒ–è¨­å®š

### 13.2 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
1. Vercel / Netlifyã«ãƒ‡ãƒ—ãƒ­ã‚¤
2. ç’°å¢ƒå¤‰æ•°è¨­å®š
3. ãƒ“ãƒ«ãƒ‰ & ãƒ‡ãƒ—ãƒ­ã‚¤

---

## 14. ä»Šå¾Œã®æ‹¡å¼µæ¡ˆ

- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ï¼ˆSupabase Authï¼‰
- [ ] ã‚²ãƒ¼ãƒ å±¥æ­´ãƒ»çµ±è¨ˆ
- [ ] AIã‚¹ãƒ‘ã‚¤ãƒã‚¹ã‚¿ãƒ¼ï¼ˆLLMã§ãƒ’ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆï¼‰
- [ ] è‹±èªç‰ˆå˜èªãƒ‘ãƒƒã‚¯è¿½åŠ 
- [ ] ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒï¼ˆãƒ‡ãƒ¥ã‚¨ãƒƒãƒˆã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚«ãƒãƒ¼ç­‰ï¼‰
- [ ] ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªï¼ˆReact Native + Supabaseï¼‰
- [ ] Edge Functionsã§ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–

---

## 15. å‚è€ƒãƒªãƒ³ã‚¯

- [Codenames å…¬å¼ãƒ«ãƒ¼ãƒ«](https://czechgames.com/files/rules/codenames-rules-en.pdf)
- [Supabase ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://supabase.com/docs)
- [Supabase Realtime](https://supabase.com/docs/guides/realtime)
- [Supabase JavaScript Client](https://supabase.com/docs/reference/javascript)